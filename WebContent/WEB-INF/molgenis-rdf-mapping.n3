@prefix map: <file:///stdout#> .
@prefix db: <> .
@prefix vocab: <http://localhost:8080/molgenis_distro/vocab/resource/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix d2rq: <http://www.wiwiss.fu-berlin.de/suhl/bizer/D2RQ/0.1#> .
@prefix jdbc: <http://d2rq.org/terms/jdbc/> .
@prefix d2r: <http://sites.wiwiss.fu-berlin.de/suhl/bizer/d2r-server/config.rdf#> .

<> a d2r:Server;
    rdfs:label "D2R Server";
    d2r:baseURI <http://localhost:8080/pheno/>;
    d2r:port 8080;
    d2r:documentMetadata [
        rdfs:comment "This comment is custom document metadata.";
    ];
	d2r:vocabularyIncludeInstances true;    
    .

# Should be jndi loaded!
map:database a d2rq:Database;
	d2rq:jdbcDriver "com.mysql.jdbc.Driver";
	d2rq:jdbcDSN "jdbc:mysql://localhost:3306/molgenis_test?innodb_autoinc_lock_mode=2";
	d2rq:username "molgenis";
	d2rq:password "molgenis";
	jdbc:autoReconnect "true";
	jdbc:zeroDateTimeBehavior "convertToNull";
	.
# Entity Experiment
map:Experiment a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "Experiment/@@Experiment.Id@@";
	d2rq:class vocab:Experiment;
	d2rq:classDefinitionLabel "";
	d2rq:classDefinitionComment "Summary of an experiment. ";
	.	
# todo: use the xref labels if they are complete
# label for Experiment using primary key
map:Experiment__label a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Experiment;
	d2rq:property rdfs:label;
	d2rq:pattern "Experiment #@@Experiment.Id@@";
	.
map:Experiment_description a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Experiment;
	d2rq:property vocab:Experiment_Description;
	d2rq:propertyDefinitionLabel "Description";
	d2rq:propertyDefinitionComment "Optional description text";
	d2rq:column "Experiment.Description";
	d2rq:datatype xsd:text;
	.
map:Experiment_date a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Experiment;
	d2rq:property vocab:Experiment_Date;
	d2rq:propertyDefinitionLabel "Date";
	d2rq:propertyDefinitionComment "Creation date, with an automatic default to 'today'";
	d2rq:column "Experiment.Date";
	d2rq:datatype xsd:date;
	.
map:Experiment_id a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Experiment;
	d2rq:property vocab:Experiment_Id;
	d2rq:propertyDefinitionLabel "Id";
	d2rq:propertyDefinitionComment "autogenerated id number (autoid)";
	d2rq:column "Experiment.Id";
	d2rq:datatype xsd:int;
	.
# Entity Sample
map:Sample a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "Sample/@@Sample.Id@@";
	d2rq:class vocab:Sample;
	d2rq:classDefinitionLabel "";
	d2rq:classDefinitionComment "Samples that are part of an experiment. ";
	.	
# todo: use the xref labels if they are complete
# label for Sample using primary key
map:Sample__label a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Sample;
	d2rq:property rdfs:label;
	d2rq:pattern "Sample #@@Sample.Id@@";
	.
map:Sample___Type a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Sample;
	d2rq:property vocab:Sample___Type;
	d2rq:propertyDefinitionLabel "__Type";
	d2rq:propertyDefinitionComment "Subtypes have to be set to allow searching";
	d2rq:column "Sample.__Type";
	d2rq:datatype xsd:string;
	.
map:Sample_experiment a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Sample;
	d2rq:property vocab:Sample_Experiment;
	d2rq:propertyDefinitionLabel "Experiment";
	d2rq:propertyDefinitionComment "Samples are part-of one experiment (by cross reference to Experiment.id)";
	d2rq:refersToClassMap map:Experiment;
	d2rq:join "Sample.Experiment => Experiment.Id";
	.
map:Sample_species a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Sample;
	d2rq:property vocab:Sample_Species;
	d2rq:propertyDefinitionLabel "Species";
	d2rq:propertyDefinitionComment "Species, default to Arabidopsis";
	d2rq:column "Sample.Species";
	d2rq:datatype xsd:string;
	.
map:Sample_tissue a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Sample;
	d2rq:property vocab:Sample_Tissue;
	d2rq:propertyDefinitionLabel "Tissue";
	d2rq:propertyDefinitionComment "Optional specification of tissue";
	d2rq:column "Sample.Tissue";
	d2rq:datatype xsd:string;
	.
map:Sample_sex a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Sample;
	d2rq:property vocab:Sample_Sex;
	d2rq:propertyDefinitionLabel "Sex";
	d2rq:propertyDefinitionComment "Fixed choice on Sex";
	d2rq:column "Sample.Sex";
	d2rq:datatype xsd:string;
	.
map:Sample_sampleTime a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Sample;
	d2rq:property vocab:Sample_SampleTime;
	d2rq:propertyDefinitionLabel "SampleTime";
	d2rq:propertyDefinitionComment "SampleTime";
	d2rq:column "Sample.SampleTime";
	d2rq:datatype xsd:dateTime;
	.
map:Sample_id a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Sample;
	d2rq:property vocab:Sample_Id;
	d2rq:propertyDefinitionLabel "Id";
	d2rq:propertyDefinitionComment "autogenerated id number (autoid)";
	d2rq:column "Sample.Id";
	d2rq:datatype xsd:int;
	.
# Entity SpecialSample
map:SpecialSample a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "SpecialSample/@@SpecialSample.Id@@";
	d2rq:class vocab:SpecialSample;
	d2rq:classDefinitionLabel "";
	d2rq:classDefinitionComment "";
	.	
# todo: use the xref labels if they are complete
# label for SpecialSample using primary key
map:SpecialSample__label a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:SpecialSample;
	d2rq:property rdfs:label;
	d2rq:pattern "SpecialSample #@@SpecialSample.Id@@";
	.
map:SpecialSample_detail a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:SpecialSample;
	d2rq:property vocab:SpecialSample_detail;
	d2rq:propertyDefinitionLabel "detail";
	d2rq:propertyDefinitionComment "detail";
	d2rq:column "SpecialSample.detail";
	d2rq:datatype xsd:string;
	.
map:SpecialSample_id a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:SpecialSample;
	d2rq:property vocab:SpecialSample_Id;
	d2rq:propertyDefinitionLabel "Id";
	d2rq:propertyDefinitionComment "autogenerated id number (autoid)";
	d2rq:column "SpecialSample.Id";
	d2rq:datatype xsd:int;
	.
# Entity Trait
map:Trait a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "Trait/@@Trait.Id@@";
	d2rq:class vocab:Trait;
	d2rq:classDefinitionLabel "";
	d2rq:classDefinitionComment "Traits that are studied in this experiment. ";
	.	
# todo: use the xref labels if they are complete
# label for Trait using primary key
map:Trait__label a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Trait;
	d2rq:property rdfs:label;
	d2rq:pattern "Trait #@@Trait.Id@@";
	.
map:Trait_molecular a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Trait;
	d2rq:property vocab:Trait_Molecular;
	d2rq:propertyDefinitionLabel "Molecular";
	d2rq:propertyDefinitionComment "Indication whether this is a molecular trait";
	d2rq:column "Trait.Molecular";
	d2rq:datatype xsd:boolean;
	.
map:Trait_experiment a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Trait;
	d2rq:property vocab:Trait_Experiment;
	d2rq:propertyDefinitionLabel "Experiment";
	d2rq:propertyDefinitionComment "Traits are defined per experiment (by cross reference to Experiment.id)";
	d2rq:refersToClassMap map:Experiment;
	d2rq:join "Trait.Experiment => Experiment.Id";
	.
map:Trait_id a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Trait;
	d2rq:property vocab:Trait_Id;
	d2rq:propertyDefinitionLabel "Id";
	d2rq:propertyDefinitionComment "autogenerated id number (autoid)";
	d2rq:column "Trait.Id";
	d2rq:datatype xsd:int;
	.
# Entity Data
map:Data a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "Data/@@Data.Id@@";
	d2rq:class vocab:Data;
	d2rq:classDefinitionLabel "";
	d2rq:classDefinitionComment "Data values (observations) of a measurement. Note: Data doesn't inherit from Identifiable because it has no unique name. ";
	.	
# todo: use the xref labels if they are complete
# label for Data using primary key
map:Data__label a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Data;
	d2rq:property rdfs:label;
	d2rq:pattern "Data #@@Data.Id@@";
	.
map:Data_id a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Data;
	d2rq:property vocab:Data_Id;
	d2rq:propertyDefinitionLabel "Id";
	d2rq:propertyDefinitionComment "autogenerated id number";
	d2rq:column "Data.Id";
	d2rq:datatype xsd:int;
	.
map:Data_experiment a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Data;
	d2rq:property vocab:Data_Experiment;
	d2rq:propertyDefinitionLabel "Experiment";
	d2rq:propertyDefinitionComment "Measurements are part-of one experiment";
	d2rq:refersToClassMap map:Experiment;
	d2rq:join "Data.Experiment => Experiment.Id";
	.
map:Data_sample a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Data;
	d2rq:property vocab:Data_Sample;
	d2rq:propertyDefinitionLabel "Sample";
	d2rq:propertyDefinitionComment "The sample this measurement is on";
	d2rq:refersToClassMap map:Sample;
	d2rq:join "Data.Sample => Sample.Id";
	.
map:Data_trait a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Data;
	d2rq:property vocab:Data_Trait;
	d2rq:propertyDefinitionLabel "Trait";
	d2rq:propertyDefinitionComment "The trait this measurement is on";
	d2rq:refersToClassMap map:Trait;
	d2rq:join "Data.Trait => Trait.Id";
	.
map:Data_value a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Data;
	d2rq:property vocab:Data_Value;
	d2rq:propertyDefinitionLabel "Value";
	d2rq:propertyDefinitionComment "The value measured/calculated";
	d2rq:column "Data.Value";
	d2rq:datatype xsd:string;
	.
# Entity AggregateData
map:AggregateData a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "AggregateData/@@AggregateData.Id@@";
	d2rq:class vocab:AggregateData;
	d2rq:classDefinitionLabel "";
	d2rq:classDefinitionComment "Data on multiple samples in one go. ";
	.	
# todo: use the xref labels if they are complete
# label for AggregateData using primary key
map:AggregateData__label a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:AggregateData;
	d2rq:property rdfs:label;
	d2rq:pattern "AggregateData #@@AggregateData.Id@@";
	.
map:AggregateData_id a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:AggregateData;
	d2rq:property vocab:AggregateData_Id;
	d2rq:propertyDefinitionLabel "Id";
	d2rq:propertyDefinitionComment "autogenerated id number";
	d2rq:column "AggregateData.Id";
	d2rq:datatype xsd:int;
	.
map:AggregateData_experiment a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:AggregateData;
	d2rq:property vocab:AggregateData_Experiment;
	d2rq:propertyDefinitionLabel "Experiment";
	d2rq:propertyDefinitionComment "Measurements are part-of one experiment";
	d2rq:refersToClassMap map:Experiment;
	d2rq:join "AggregateData.Experiment => Experiment.Id";
	.
map:AggregateData_samples a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:AggregateData;
	d2rq:property vocab:AggregateData_Samples;
	d2rq:propertyDefinitionLabel "Samples";
	d2rq:propertyDefinitionComment "The samples this measurement is on";
	d2rq:refersToClassMap map:Sample;
	d2rq:join "AggregateData.Id <= AggregateData_Samples.AggregateData";
	d2rq:join "AggregateData_Samples.Samples => Sample.Id";
	.
map:AggregateData_trait a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:AggregateData;
	d2rq:property vocab:AggregateData_Trait;
	d2rq:propertyDefinitionLabel "Trait";
	d2rq:propertyDefinitionComment "The trait this measurement is on";
	d2rq:refersToClassMap map:Trait;
	d2rq:join "AggregateData.Trait => Trait.Id";
	.
map:AggregateData_value a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:AggregateData;
	d2rq:property vocab:AggregateData_Value;
	d2rq:propertyDefinitionLabel "Value";
	d2rq:propertyDefinitionComment "The value measured/calculated";
	d2rq:column "AggregateData.Value";
	d2rq:datatype xsd:string;
	.
